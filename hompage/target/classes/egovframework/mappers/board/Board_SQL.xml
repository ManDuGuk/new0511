<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="egovframework.let.board.service.impl.BoardMapper">
	
	<!-- <resultMap id="crud" type="egovframework.let.crud.service.CrudVO">
		<result property="crudId" column="CRUD_ID"/>
		<result property="crudSj" column="CRUD_SJ"/>
		<result property="crudCn" column="CRUD_CN"/>
		<result property="userNm" column="USER_NM"/>
		<result property="frstRegistPnttm" column="FRST_REGIST_PNTTM"/>
	</resultMap> -->
	
	
	
	<select id="selectBoardList" resultType="egovMap">
		SELECT
		 A.BOARD_ID
		 ,A.BOARD_SJ
		 ,A.BOARD_CN
		 ,A.INQIRE_CO
		 ,A.CREAT_IP
		 ,A.NOTICE_AT
		 ,A.OTHBC_AT
		 ,A.USE_AT
		 ,A.ATCH_FILE_ID
		 ,A.FRST_REGIST_PNTTM
		 ,A.FRST_REGISTER_ID
		 FROM BOARD A
		 <include refid="selectBoardListWhere"></include>
		 ORDER BY A.FRST_REGIST_PNTTM DESC
		 
		 <if test='noticeAt !="Y"'>
		 	LIMIT #{recordCountPerPage} OFFSET #{firstIndex}
		 </if>
	</select>
	
	<select id="selectBoardListCnt" resultType="java.lang.Integer">
		SELECT
		  COUNT(*) CNT
		FROM BOARD A
		<include refid="selectBoardListWhere"></include>
	</select>
	
	<sql id="selectBoardListWhere">
		<where>
			A.USE_AT='Y'
				<choose>
					<when test='noticeAt == "Y"'>
						AND A.NOTICE_AT='Y'
					</when>
					<otherwise>
						<if test='searchCondition !=null and searchCondition !=""'>
							<choose>
								<when test='searchCondition =="0"'>
									AND A.BOARD_SJ LIKE CONCAT('%',#{searchKeyword},'%')
								</when>
								<when test='searchCondition =="1"'>
									AND A.BOARD_CN LIKE CONCAT('%',#{searchKeyword},'%')
								</when>
								<when test='searchCondition =="2"'>
									AND A.FRST_REGISTER_ID LIKE CONCAT('%',#{searchKeyword},'%')
								</when>
							</choose>
						</if>
					</otherwise>
				</choose>
		</where>
	</sql>
	
	<insert id="insertBoard" parameterType="egovframework.let.board.service.BoardVO">
		INSERT INTO BOARD (
		<!-- 값을 파라미터에서 받아오는지 디비에서 디폴트로 설정하는것이지 생각해서 값을 넣어줘야한다. -->
			 BOARD_ID
			 ,BOARD_SJ
			 ,BOARD_CN
			 ,INQIRE_CO
			 ,CREAT_IP
			 ,NOTICE_AT
			 ,OTHBC_AT
			 ,USE_AT
			 ,ATCH_FILE_ID
			 ,FRST_REGIST_PNTTM
			 ,FRST_REGISTER_ID
			 ,LAST_UPDT_PNTTM
			 ,LAST_UPDUSR_ID
		) VALUES (
			#{boardId}
			, #{boardSj}
			, #{boardCn}
			, 0
			, #{creatIp}
			, #{noticeAt}
			, #{othbcAt}
			, 'Y'
			, #{atchFileId}
			, NOW()
			, #{userId}
			, NOW()
			, #{userId}
		)
	</insert>
	
	
</mapper>
	<!-- <insert id="insertCrud" parameterType="crudVO">
		INSERT INTO LETCRUD (
			CRUD_ID
		    , CRUD_SJ
		    , CRUD_CN
		    , USER_NM
		    , FRST_REGIST_PNTTM
		) VALUES (
			#{crudId}
			, #{crudSj}
			, #{crudCn}
			, #{userNm}
			, NOW()
		)
	</insert>
	
	<select id="selectCrud" resultMap="crud">
		SELECT
		  CRUD_ID
		  , CRUD_SJ
		  , CRUD_CN
		  , USER_NM
		  , FRST_REGIST_PNTTM
		FROM LETCRUD
		WHERE CRUD_ID = #{crudId}
	</select>
	
	<update id="updateCrud" parameterType="egovframework.let.crud.service.CrudVO">
		UPDATE LETCRUD SET
			CRUD_SJ = #{crudSj}
		    , CRUD_CN = #{crudCn}
		    , USER_NM = #{userNm}
		WHERE CRUD_ID = #{crudId}
	</update>
	
	<delete id="deleteCrud" parameterType="egovframework.let.crud.service.CrudVO">
		DELETE FROM LETCRUD
		WHERE CRUD_ID = #{crudId}
	</delete> -->
	
